<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        margin: 0;
        font-size: 18px;
      }
      .container {
        height: 500vh;
        background: blue;
        width: 600px;
        max-width: 100%;
        margin-left: auto;
        margin-right: auto;
      }
      .element {
        min-height: 200px;
        background-color: red;
        padding: 1rem;
        width: 300px;
      }

      .static {
        position: static;
      }

      .relative {
        position: relative;
      }

      .absolute {
        position: absolute;
        left: 3rem;
        top: 0.5rem;
      }

      .absolute.green {
        background: green;
        top: 1rem;
        z-index: 2;
      }
      .absolute.black {
        background: black;
        top: 1.5rem;
        z-index: 3;
      }
      .absolute.yellow {
        background: yellow;
        top: 2rem;
      }

      .fixed {
        position: fixed;
        left: 4rem;
        top: 4rem;
        background: purple;
      }

      .mon_lien {
        color: white;
        font-size: 4rem;
      }
    </style>
  </head>
  <body>
    <div class="container relative">
      <div class="element absolute">Mon contenu</div>
      <div class="element absolute green">Mon contenu</div>
      <div class="element absolute black">Mon contenu</div>
      <div class="element absolute yellow">Mon contenu</div>
    </div>
  </body>
</html>


 <div id="modal_content">
            <div style=" position:relative;" class="modal-wrapper">
                <div class="overlay" id="overlayInscription">

                    <div style=" padding-bottom:50px; padding-top:50px;" class="modal" id="modalFormInscription" > 
                        <span class="closeModal" data-target="modalFormInscription">&times;</span>
                    <?php if ((!$estConnecte) || ($role === 'admin')) {include '../composants/modal/inscription.php';} ?>
                    </div>
                     <!-- <div style="display:block;" class="modal-spacer"></div>  -->
                </div>

            </div>
            
            <div style=" position:relative;" class="modal-wrapper">
                <div class="overlay" id="overlayConnexion">
                    <div style=" padding-bottom:50px; padding-top:50px;" class="modal" id="modalFormConnexion" >
                        <span class="closeModal" data-target="modalFormConnexion">&times;</span>
                    <?php if ((!$estConnecte) || ($role === 'admin')) {include '../composants/modal/connexion.php';} ?>
                    </div>
                    <!-- <div style="display:block;" class="modal-spacer"></div>   -->
                </div>
            </div> 


        
        
            
            <div style=" position:relative;" class="modal-wrapper">
                <div class="overlay" id="overlayMotDePasseOublie">
                    <div  style=" padding-bottom:30px; padding-top:30px;" class="modal" id="modalFormMotDePasseOublie">
                        <span class="closeModal" data-target="modalFormMotDePasseOublie">&times;</span>
                    <?php if ((!$estConnecte) || ($role === 'admin')) { include '../composants/modal/motDePasseOublie.php';}?>
                    </div>
                    <!-- <div style="display:block;" class="modal-spacer"></div>  -->
                </div>
                

            </div>
            <div style=" position:relative;" class="modal-wrapper">
                <div class="overlay" id="overlayConditionsUtilisation">
                    <div style=" padding-bottom:50px; padding-top:50px;" class="modal" id="modalFormConditionsUtilisation">
                        <span class="closeModal" data-target="modalFormConditionsUtilisation">&times;</span>
                    <?php if ((!$estConnecte) || ($role === 'admin'))
                    {
                    include '../composants/modal/conditionsUtilisation.php';} ?>
                    </div>
                </div>
                <!-- <div style=" position:relative;"class="modal-spacer"></div>  -->
            </div>
            <div style=" position:relative;" class="modal-wrapper">
                <div class="overlay" id="overlayRedefinitionMotDePasse">

                    <div style=" padding-bottom:50px; padding-top:50px;" class="modal <?php echo (!$affichageFormulaireRedefinitionMotDePasse) ? 'displayNone':'displayBlock'; ?>" id="modalFormRedefinitionMotDePasse">
                    <span class="closeModal" data-target="modalFormRedefinitionMotDePasse">&times;</span>
                    <?php if ((!$estConnecte) || ($role === 'admin')) include '../composants/modal/redefinition_motDePasse.php'; ?>
                    </div>
                     <!-- <div style="display:block;" class="modal-spacer"></div>  -->
                </div>
            </div>
            <div style=" position:relative;" class="modal-wrapper">
                <div class="overlay" id="overlayRechercheAvancee">
            
                    <div style=" padding-bottom:50px; padding-top:50px;" class="modal"id="modalFormRechercheAvancee">
                        <span class="closeModal" data-target="modalFormRechercheAvancee">&times;</span>
                        <?php include '../composants/modal/recherche_evenement.php'; ?>
                    </div>
                    <!-- <div  style="display:block;"class="modal-spacer"></div>  -->
                </div>

            </div>
            <div class="modal-wrapper">
                <div class="overlay" id="overlayDetailsEvenement">
                    <div style=" padding-bottom:50px; padding-top:50px;" class="modal" id="modalDetailsEvenement">
                        <span class="closeModal" data-target="modalDetailsEvenement">&times;</span>
                    <?php include '../composants/modal/detailsEvenement.php'; ?> 
                    </div>
                    <!-- <div  style="display:block;"class="modal-spacer"></div>  -->

                </div>

                
            </div>
        
        </div>

        
Domaine / hôte (host) : localhost -->
 <div class="event-card" style="width:620px; background-color: #F8F3EB; opacity: 0.7; border: #704405 solid 1px; display:flex; flex-direction:row; justify-content:space-between; align-items:center;" id="eventSelected" >
        
    <div class="left-column"style="margin-top:25px; display:flex; flex-direction:column; justify-content:space-between;   width:200px"  class="" style=" margin-top: 20px;">
        <h3><?php  echo !empty($evenementSelected['prenom-utilisateur'])? "Evenement Public" : 'Evenement Prive'; ?></h3>
        <h4><?php  echo $evenementSelected['style_evenement']; ?></h4>
        <?php if (!function_exists('cleanImagePath')) {
    function cleanImagePath($fullPath) {
        if ($fullPath === null) {
            return $fullPath;
        }
        return str_replace('/moncoinludique/vue/', '../', $fullPath);
    }
}
$evenementSelected['image_evenement']=cleanImagePath($evenementSelected['image_evenement']);
      ?>
        <label style="margin-top: 25px; cursor:pointer; display:inline-block;" for="photoInput" class="photo-label">
                <div class="photo-container">
                    
                    <img style="" src="<?php  echo $evenementSelected['image_evenement']; ?>" alt="Photo" class="photoEvent" />
                </div>
        </label>
    </div>
    <div class="center-column" style="margin-top:25px; display:flex; flex-direction:column; justify-content:space-between;   width:200px" class="" style=" margin-top: 20px;">
        <div class="photo-container" style="position:relative;">
            <?php 
$evenementSelected['imageProfil']=cleanImagePath($evenementSelected['imageProfil']);
      ?>
            <label style="margin-top: 25px; cursor:pointer; display:inline-block;" for="photoInput" class="photo-label">
                <div class="photo-container">
                    <img style="" src="<?php  echo $evenementSelected['imageProfil']; ?>" alt="Photo" class="photoProfil" />
                </div>
            </label>
            <div class="host-info">
                <h3><?php  echo $evenementSelected['pseudo'];?></h3>
                <h4><?php  echo "alias ".$evenementSelected['prenom_utilisateur']." ".$evenementSelected['nom_utilisateur']; ?></h4>
            </div>

        </div>
       <div class="event-info">
            <div  style="display:flex; flex-direction:row; justify-content:space-between;align-items:center; width:305px;" >
                <div class="dateetHeureEvenement"><strong>Date et heure de l'evenement</strong></div3>
                <div class="valueDateHeureEvenement"><?php  echo $evenementSelected['date_evenement']." ". $evenementSelected['heure']; //echo $dateEvenement." ". $heureEvenement; ?></div>
            </div>
            <div  style="display:flex; flex-direction:row; justify-content:space-between;align-items:center; width:305px;">
                <div><strong class="lieu">Lieu</strong></div>
                <div><?php  echo $evenementSelected['adresse_ville']; //echo $lieuEvenement; ?></div>
            </div>
            <div style="display:flex; flex-direction:row; justify-content:space-between; align-items:center; width:305px;">
                <strong class="places_restantes">Places restantes</strong>
                <?php
                    $nbInscrits = intval($evenementSelected['nbInscrits']);
                    $nbParticipantsMax = intval($evenementSelected['nbParticipants_max']);
                    $placesRestantes = $nbParticipantsMax - $nbInscrits;

                    if ($placesRestantes > 0) {
                        echo '<div class="valuePlacesRestantes">' . $placesRestantes . '</div>';
                    } else {
                        echo '<div class="valuePlacesRestantes">Complet</div>'; // Optionnel : afficher "Complet" ou rien
                    }
                ?>
            </div>
        </div>
 
    </div>
    <div class="right-column">
        <form action="../controller/controller.php" method="post">
            <input type="hidden" name="idEvenement" value="<?php echo htmlspecialchars($evenementSelected["id_evenement"]); ?>">

            <?php if ($page_contexte === 'accueil' || $page_contexte === 'actionEvenement'): ?>
                <button
                    type="submit"
                    name="action"
                    value="voir_details"
                    class="btnVoirEvenement"
                    style="width:114px; height:40px; background-color:#6EBA46; color:#FFF; font-size:18px; font-weight:600;"
                >
                    Voir
                </button>

            <?php elseif ($page_contexte === 'gestion_evenement'): ?>
                <button
                    type="submit"
                    name="action"
                    value="voir_gestion"
                    class="btnVoirEvenement"
                    style="width:114px; height:40px; background-color:#004B87; color:#FFF; font-size:18px; font-weight:600;"
                >
                    Gérer
                </button>
            <?php endif; ?>
        </form>
    </div>  
</div>
function areValidChamps($datas,$allChampsNecessaryPresents)
{


    $areValidChamps=[];
    // var_dump($areValidChamps);
    // var_dump($datas);
    $phraseEchec=[]; 
    foreach ($datas as $nomChamp => $valeurChamp) {
        if ($nomChamp === "confirmationMotDePasse") {
            if (!isset($datas["motDePasse"]) || $valeurChamp !== $datas["motDePasse"]) {
                return [
                    "success" => false,
                    "phraseEchec" => "Les deux mots de passe ne correspondent pas"
                ];
            }
            // Passe au champ suivant, on ne valide pas ce champ plus loin
            continue;
        }
    //    echo "$nomChamp $valeurChamp".$valeurChamp;
    
       if (empty($valeurChamp)) {
            // Si c’est un champ obligatoire => ERREUR
            if (in_array($nomChamp, $allChampsNecessaryPresents)) {
                $phraseEchec[] = "Le champ '$nomChamp' est obligatoire et ne peut pas être vide.";
                $areValidChamps[] = false;
            } else {
                // Sinon c’est un champ optionnel => on accepte
                $areValidChamps[] = true;
            }
            continue; // Passe au champ suivant
        }
        // echo "313nomChamp".$nomChamp."valeurChamp".$valeurChamp."<br>";

    //    echo "nomChamp".$nomChamp."valeurChamp".$valeurChamp."<br>";
        $isValidChamp=champIsValid($nomChamp,$valeurChamp);
        if ($isValidChamp==null) {
            // echo "320nomChamp".$valeurChamp;
    // La fonction champIsValid n’a pas renvoyé un tableau, on considère que c’est une erreur
            return [
                "success" => false,
                "phraseEchec" => "Erreur interne de validation sur le champ '$nomChamp'."
            ];
        }
        // echo "318".$isValidChamp["success"];
        $areValidChamps[]=$isValidChamp["success"];
        // echo " 317";
        // var_dump($areValidChamps);
        if ($isValidChamp["success"]==false) {
            $phraseEchec[]=$isValidChamp["phraseEchec"];
        } 

    }
     
     $phraseReussite="Tous les champs sont valides";
    if (in_array(false, $areValidChamps)) {
        $phrasesEchec=implode(", ", $phraseEchec);

        // var_dump($areValidChamps);
        return [
            "success" => false,
            "phraseEchec" => $phrasesEchec
        ];
    } else {
        
        //  var_dump($areValidChamps);
        return [
            "success" => true,
            "phraseReussite" => $phraseReussite
        ];
    }
    }


    
<?php 
if (session_status() == PHP_SESSION_NONE) {
    session_start();
}

// echo "<script>console.log('arrive dans inscription ligne6');</script>";
   var_dump($_POST);
  //  var_dump($_SESSION);
// // session_destroy();
include_once ($_SERVER['DOCUMENT_ROOT'].'/model/db.php'); //require $_SERVER['DOCUMENT_ROOT'] /model/db.php';

require ($_SERVER['DOCUMENT_ROOT'].'/model/model.php');
//fonctiosns helpers
 
function handleLoginAndRegistration() {
   echo"ligne17";
  if ((!isset($_POST['btnAdminLoginAsUser']))&&(!isset($_POST['btnInscription']))&&(!isset($_POST['btnEnvoiReponsesRecupMotDePasse']))&& (!isset($_SESSION['id']))&& (!isset($_POST['btnConnexion']))){
     
    if (isset($_POST['researchAllEvent'])){
      echo "ligne21controller";
      $events=selectAllEvents();
      if (!$events) {
          $events=["pas d'evenement"];
        }
        $_SESSION['list_evenements'] = $events;
        $_SESSION["refresh"]=true;
        locationView('accueil');
        exit();
   
      

      } else {
        $_SESSION["refresh"]=true;
        locationView('accueil');
        exit();
      }
  }
  // echo "ligne20 controller";
//   var_dump($_POST);
//  var_dump($_SESSION);
  // var_dump($_POST);
  // echo "<script>console.log('arrive dans inscription ligne17');</script>";
  if ( isset($_POST['btnEnvoiReponsesRecupMotDePasse'])){
    // echo"ligne23 controller";
    // var_dump($_POST);
     $result=allChampsNecessaryPresents($_POST,'reponsesQuestionForRecupMotDePasse');
    if ($result["success"]==true){ 
      $champNecessaryPresents=$result["champNecessaryPresents"];
   
      // echo"ligne26 controller";
     
      $datas=trimData($_POST);
      $datas=protectData($datas);
      $datas["reponse2"]=$datas["chanteurPrefereUser"];
      $datas["reponse1"]=$datas["jeuPrefereUser"];
      //verif exist in db va rechercher dans la bd si l'utilisateur existe ou non suivant le mail si il existe
      $result=verifExistInDb($datas);
      // var_dump($result);
     
      if (is_array($result) && isset($result["success"]) && $result["success"] === true){
          $id_utilisateur=$result["utilisateur"] ["id_utilisateur"];
        $result=importReponsesQuestions($id_utilisateur);

          $firstReponseInBD=$result["reponse1"];
          $firstReponseInBD=htmlspecialchars(trim($firstReponseInBD));
          $secondReponseInBD=$result["reponse2"];
          $secondReponseInBD=htmlspecialchars(trim($secondReponseInBD));
          if (($firstReponseInBD==$datas["reponse1"])&&($secondReponseInBD==$datas["reponse2"])){
            // echo "reussite";
            // var_dump($_SESSION);
          $_SESSION['redefinitionMotDePasse']=true;
          $_SESSION['email']=$datas['email'];
          $_SESSION["refresh"]=true;
            locationView('accueil');
          

          }
        else if (($firstReponseInBD!=$datas["reponse1"])&&($secondReponseInBD!=$datas["reponse2"])){
          $phrase="Les reponses sont incorrectes";
        } else {
          $phrase="erreur";
        }
      }
    } else {
      echo "problème";
    }
  }
  if (isset($_POST['btnRedefinitionMotDePasse'])){
    // var_dump($_POST);
      $result=allChampsNecessaryPresents($_POST,'btnRedefinitionMotDePasse');
    if ($result["success"]==true){ 
      $champNecessaryPresents=$result["champNecessaryPresents"];
      $datas=trimData($_POST);
      $datas=protectData($datas);
      //verif exist in db va rechercher dans la bd si l'utilisateur existe ou non suivant le mail si il existe
      $result=verifExistInDb($datas);
      // var_dump($result);
      if (is_array($result) && isset($result["success"]) && $result["success"] === true){
      modificationMotDePasse($datas); 
      $_SESSION["refresh"]=true;

       locationView('gestion_evenements');
     
      }
      else {
        $phrase=$result["phraseEchec"];
      }
    }
  }

  if  (isset($_POST['btnConnexion'])){
    // echo "ligne 88 controller";
     $result=allChampsNecessaryPresents($_POST,'connexion');
    if ($result["success"]==true){ 
      $champNecessaryPresents=$result["champNecessaryPresents"];
  
   
      // echo "ligne 89 controller/n";
        $datas=trimData($_POST);
        $datas=protectData($datas);
        $result=areValidChamps($datas,$champNecessaryPresents);
        // var_dump($result);
        // echo"lignes 93 controller";
          if ($result["success"]==true){
            // echo"ligne 94 controller";
          $result=verifExistInDb($datas);
          //  var_dump($result);
          //  echo"ligne97 controller";

            if ($result["success"]==true){
                $userFound=$result["utilisateur"];
                $result=verifPassword($datas,$userFound);
                // echo"lignes 97 controller";
                  // var_dump($result);
                if ($result["success"]==true){
                    //  var_dump($result);
                    $_SESSION['id_utilisateur'] = $result['utilisateur']['id_utilisateur'];
                    $_SESSION['pseudo'] = $result['utilisateur']['pseudo'];
                    $_SESSION['role'] = $result['utilisateur']['role'];
                    session_write_close();
                    $_SESSION["refresh"]=true;
                     locationView('gestion_evenements');
                    exit();
                }

              else {
                      $phrase=$result["phraseEchec"];

                      }
              } else {
                  $phrase=$result["phraseEchec"];
              }
          } else {
              $phrase=$result["phraseEchec"];
          }
       }
    }
if (isset($_POST['btnAdminLoginAsUser']) && $_SESSION['role'] === 'admin') {
  // var_dump($_POST);
     $_SESSION['role'] = 'particulier';
       $result=allChampsNecessaryPresents($_POST,'connexionAdminAsUser');
    if ($result["success"]==true){ 
      $champNecessaryPresents=$result["champNecessaryPresents"];
  
        $datas=trimData($_POST);
        $datas=protectData($datas);
        $result=areValidChamps($datas,$champNecessaryPresents);
          if ($result["success"]==true){

          $result=verifExistInDb($datas);
          //  var_dump($result);
            if ($result["success"]==true){
                $userFound=$result["utilisateur"];
               
                $_SESSION['id_utilisateur'] = $result['utilisateur']['id_utilisateur'];
                $_SESSION['pseudo'] = $result['utilisateur']['pseudo'];
                $_SESSION['role'] = $result['utilisateur']['role'];
                $_SESSION["refresh"]=true;
                    session_write_close();
                     locationView('gestion_evenements');
                    exit();
                }

              else {
                      $phrase=$result["phraseEchec"];

                      }
              } else {
                  $phrase=$result["phraseEchec"];
              }
          } else {
              $phrase=$result["phraseEchec"];
          }
       }
    


    // Traiter la connexion en tant qu’un autre utilisateur

// var_dump($_SESSION);
// var_dump($_POST);
  if (isset($_POST['btnInscription'])){

    $roleDemande  = htmlspecialchars(trim($_POST['role'] ?? 'particulier'));
    $roleSession = $_SESSION['role'] ?? null;
    if ($roleSession === 'admin') {
    $_POST['role'] = $roleDemande;
} else {
   if ($roleDemande === 'particulier' || $roleDemande === 'groupe') {
       $_POST['role'] = $roleDemande;
    } else {
        $_POST['role'] = 'particulier'; // sécurité par défaut
    }
}
    $file=$_FILES['imageProfil'];
    // echo"ligne195";
    // echo "<script>console.log('arrive dans inscription ligne50');</script>";
    if (isset($file)) {
             $_POST["imageProfil"]="exist";
      }

   $result=allChampsNecessaryPresents($_POST,'inscription');
    if ($result["success"]==true){ 
      $champNecessaryPresents=$result["champNecessaryPresents"];
// "echo inscription";
//  echo "<script>console.log('arrive dans inscription ligne42');</script>";
    
      //  var_dump($_POST);
      //  echo"ligne217";
      // var_dump($_FILES);
     
   if (isset($file)) {
           $result=verificationImageProfil();
           if ($result["success"] === false){
             $phrase=$result["phraseEchec"];
             echo $phrase;
           } else {
             $cheminTemporaireServeur=$result["cheminTemporaireServeur"];
             $fileOriginalName=$result["fileOriginalName"];
             $fileSize=$result["fileSize"];
             
            //  echo"228".$fileOriginalName;
            //  echo"229".$cheminTemporaireServeur;
            //  echo"230".$fileSize;
           }
     
      }
      // echo "ligne240";
   
        $datas=trimData($_POST);
        $datas=protectData($datas);
        $result=areValidChamps($datas,$champNecessaryPresents);
        //  echo "<script>console.log('arrive dans inscription ligne50');</script>";
        if ($result["success"]==true){
          $result=verifExistInDb($datas);
            //  echo "<script>console.log('arrive dans inscription ligne53');</script>";
          //  var_dump($result);
          // echo"true";
          
         

          if ($result["success"]==false){
                $result=insertInBD($datas);
                var_dump($result); 

            if ($result["success"]==true){
            
                $id_utilisateur=$_SESSION['id_utilisateur'];

                 $file=$_FILES['imageProfil'];
                echo"ligne220";
                var_dump($file);
                if (isset($file)) {
                    $result=enregistrementImageProfil($id_utilisateur,$cheminTemporaireServeur,$fileOriginalName);
                    if ($result["success"] === false){

                      $phrase=$result["phraseEchec"];
                    } else {
                      
                      $datas["imageEvent"]=$result["webPath"];

                      // echo"228".$datas["imageEvent"];
                      sendImageProfilInBd($_SESSION['id_utilisateur'],$datas["imageEvent"]);
                      $_SESSION["refresh"]=true;
                      locationView('gestion_evenements');

                      exit();

                    }
                    
              
      }
                // echo "reussite";

            } else {
                 $phrase=$result["data"];
                //  echo $phrase;
            }

          } else {
          $phrase=$result["phraseEchec"];
          }

        // var_dump($_SESSION);

          if (isset($_SESSION['id_utilisateur'])) {
            // echo "<script>console.log('arrive dans inscription ligne72');</script>";
$_SESSION["refresh"]=true;
           locationView('gestion_evenements');

          exit();

          }

          }  
        }
  }
}

  
function includeView($viewName) {
    include($_SERVER['DOCUMENT_ROOT'] . "/vue/{$viewName}.php");
}



 function locationView($viewName) {
    $path =  "../vue/pages/{$viewName}.php";
    header("Location: $path");
    exit();
}




if (isset($_SESSION['id_utilisateur'])) { 

 if (isset($_POST['btnResearchAllProfilInfosForThisUser'])) {

  $id_utilisateur=$_SESSION['id_utilisateur'];
  $utilisateur=selectAllInfosUtilisateurById($id_utilisateur);
  $_SESSION['utilisateur'] = $utilisateur;
  $_SESSION["refresh"]=true;
 if ($_POST['page_contexte'] === 'gestion_utilisateurs') {
    locationView('gestion_utilisateurs');
    exit();
 } else if ($_POST['page_contexte'] === 'monCompte') {
  locationView('monCompte');
  exit();
 }
}
if (isset($_POST['btnResearchAllInfosOfAllUsers'])) {
  var_dump($_POST);
  $list_utilisateurs=selectAllInfosUtilisateurs();
  $_SESSION['list_utilisateurs'] = $utilisateurs;
  $_SESSION["refresh"]=true;
  // if ($_POST['page_contexte'] === 'gestion_utilisateurs') {
  //   locationView('gestion_utilisateurs');
  //   exit();
  //  }
 
}
 if (isset($_POST['actionModifierParametresCompte'])) {

  $id_utilisateur=$_SESSION['id_utilisateur'];
  
  $parametresComptes=trimData($_POST);
  $parametresComptes=protectData($parametresComptes);
  $result=parametresCompteCorrects($parametresComptes);
  if ($result["success"]==true){
    
    $result=getChampsDifférentsParRapportBD($parametresComptes,$id_utilisateur);
      if ($result["success"]==true){
        $champsToUpdate=$result["champsToUpdate"];

        $result=whichCategoryForInsertionInBD($id_utilisateur,$champsToUpdate);
        $result=updateInBdUtilisateur($id_utilisateur,$result["champsUtilisateur"]);
        $result=updateInBdProfil($id_utilisateur,$result["champsPasswordRecup"]);

        
        // $nomsChamps = array_keys($result["champs"]);
        

      } else {
        $phrase=$result["phraseEchec"];
        echo $phrase;
      }
  } else {
    $phrase=$result["phraseEchec"];
    echo $phrase;
  }

 
  
  $_SESSION['utilisateur'] = $utilisateur;
  $_SESSION["refresh"]=true;
  locationView('monCompte');
  exit();
 }
 if (isset($_POST['researchAllEvent'])){
 
$events=selectAllEvents();
 if (!$events) {
    $events=["pas d'evenement"];
   }
  $_SESSION['list_evenements'] = $events;
  $_SESSION["refresh"]=true;
       if ($_POST['page_contexte']=="accueil") { 
            locationView('accueil');
        exit();
        } else if ($_POST['page_contexte']=="gestion_evenements") {
            locationView('gestion_evenements');
        exit();
        }
  

 }
 if (isset($_POST['researchAllEventForThisUser'])){

  $id_organisateur=$_SESSION['id_utilisateur'];
   $events=findAllEventsByOrganisateurId($id_organisateur);
   if (!$events) {
    $events=["pas d'evenement"];
   }
 
   $_SESSION['list_evenements'] = $events;
   $_SESSION["refresh"]=true;
        if ($_POST['page_contexte']=="accueil") { 
            locationView('accueil');
        exit();
        } else if ($_POST['page_contexte']=="gestion_evenements") {
            locationView('gestion_evenements');
        exit();
        }
 

 }
 if (isset($_POST['researchAllInscriptionsForThisUser'])){
  $id_inscrit=$_SESSION['id_utilisateur'];
   $events=findAllEventsByParticipantId($id_inscrit);
    if (!$events) {
    $events=["pas d'evenement"];
   }
  $_SESSION['list_evenements'] = $events;
   $_SESSION["refresh"]=true;
  locationView('accueil');
  exit();
 }

  if (isset($_POST['btnCreationEvenement'])) {

    $file=$_FILES['imageEvent'];
    // echo"ligne195";
    // echo "<script>console.log('arrive dans inscription ligne50');</script>";
    if (isset($file)) {
             $_POST["imageEvent"]="exist";
      }
    //  var_dump($_POST);
    $result=allChampsNecessaryPresents($_POST,'creationEvenement');
    if ($result["success"]==true){ 
      $champNecessaryPresents=$result["champNecessaryPresents"];
      // var_dump($champNecessaryPresents);
      if (isset($_POST['typeSoiree'])) {
        $_POST['typeSoiree'] = $_POST['typeSoiree'][0];
      } 

     echo"ligne201";
      // var_dump($_FILES);
 
      $datas=trimData($_POST);
      $datas=protectData($datas);
       echo "ligne310";
      // var_dump($datas);
      $result=areValidChamps($datas,$champNecessaryPresents);
      var_dump($result);
      //  echo "<script>console.log('arrive dans inscription ligne50');</script>";
      if ($result["success"]==true){
        echo "401";
             $file=$_FILES['imageEvent'];
    //  var_dump($file);
  
      if (isset($file)) {
           $result=enregistrementImageEvent();
           if ($result["success"] === false){
             $phrase=$result["phraseEchec"];
           } else {
             $datas["imageEvent"]=$result["webPath"];
           }
     
      }
      echo "reussite";
        $result=verifyExistInBDEvenement($datas,$_SESSION['id_utilisateur']);
         echo "328".$result["success"];
        if ($result["success"]==false)
        {
      
          $result=insertEvenementInBD($datas,$_SESSION['id_utilisateur']); 
          $_SESSION["refresh"]=true;
            // echo "reussite";
          locationView('gestion_evenements');
          exit();
           } else {
          $phrase=$result["phraseEchec"];
          $_SESSION["refresh"]=true;
          locationView('gestion_evenements');
           exit();
                  //  echo $phrase;
           }
        }
        else {
          $phrase=$result["phraseEchec"];
          $_SESSION["refresh"]=true;
          locationView('gestion_evenements');
          exit();
        }
       
    }
  }
  else if (isset($_POST['btnaction_evenement'])) {
    // var_dump($_POST);
    // var_dump($_SESSION);
    $id_evenement=$_POST['id_evenement'];
    $id_organisateur=$_SESSION['id_utilisateur'];
    $event=findAllInfosEvent($id_organisateur,$id_evenement);
    // var_dump($event);
   if (!$event) {
    echo "pas d'evenement";
    $event=["pas d'evenement"];
     locationView('actions_evenement');
   exit();
   }
 
$_SESSION['evenementSelectedSpecial'] = $event;
   $_SESSION["refresh"]=true;
   locationView('actions_evenement');
   exit();
  }
  else if (isset($_POST['btnModificationEvenement'])) {
    
  }
  else if (isset($_POST['btnSuppressionEvenement'])) {
    
  }
   

  else if  (isset($_SESSION['role']) && $_SESSION['role'] == 'admin') {
        // echo "ligne182";
        if (isset($_POST['btnInscription'])||isset($_POST['btnAdminLoginAsUser'])||isset($_POST['btnRedefinitionMotDePasse'])||isset($_POST['btnDeconnexion'])){
            //  echo "ligne185";
          handleLoginAndRegistration();
        }
        else {
          $_SESSION["refresh"]=true;
           locationView('gestion_evenements');
          exit();
        }
         
  }
  
  else {
// $_SESSION["refresh"]=true;
//     locationView('gestion_evenements');
      // exit();
   
  }
   // Si l'utilisateur est connecté
    // Afficher le dashboard ou gérer les actions envoyées
} 


  else { 
    // echo "<script>console.log('arrive dans inscription ligne123');</script>";
    // Si l'utilisateur n'est pas connecté
      handleLoginAndRegistration();
  }

?>